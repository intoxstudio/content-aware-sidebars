/*!
 * @package Content Aware Sidebars
 * @author Joachim Jensen <jv@intox.dk>
 * @license GPLv3
 * @copyright 2017 by Joachim Jensen
 */
!function(a){var b={current_section:0,sections:[],init:function(){this.tabController(),this.addHandleListener(),this.suggestVisibility(),this.initSidebarActivation(),a(".js-cas-html").on("change",function(b){var c=a(this);a(c.data("target")).attr("disabled",!c.is(":checked"))}).trigger("change")},initSidebarActivation:function(){Flatpickr.l10ns.default.weekdays=CASAdmin.weekdays,Flatpickr.l10ns.default.months=CASAdmin.months,Flatpickr.l10ns.default.firstDayOfWeek=CASAdmin.weekStart;var b={wrap:!0,clickOpens:!0,enableTime:!0,time_24hr:!0,allowInput:!0,enableSeconds:!0,altInput:!0,altFormat:CASAdmin.dateFormat+" @ H:i:S",minDate:null,maxDate:null},c=flatpickr(".js-cas-activation",b),d=flatpickr(".js-cas-expiry",b),e=a(".js-cas-status");c.config.onChange=function(a,b,c){(b||d.config.minDate)&&d.set("minDate",b?new Date(a).fp_incr(1):null),b?e.prop("checked",!1):e.is(":checked")||d.clear()},d.config.onChange=function(a,b,d){(b||c.config.maxDate)&&c.set("maxDate",b?new Date(a).fp_incr(-1):null)},e.on("change",function(b){a(this).is(":checked")?c.clear():c.selectedDates.length||d.clear()})},initTabSections:function(){a(".js-cas-tabs").find(".nav-tab").each(function(){var c=this.href.lastIndexOf("#");if(c>=0){var d=this.href.substr(c);b.sections.push(d),a(d).hide()}})},tabController:function(){this.initTabSections(),this.setCurrentSection(window.location.hash),a("#poststuff").on("click",".js-nav-link",function(a){b.setCurrentSection(this.href)})},findSectionByURL:function(a){var b=this.sections.indexOf(a.substring(a.lastIndexOf("#")));return b>=0?b:null},setCurrentSection:function(b){var c=this.findSectionByURL(b)||0,d=a(".js-cas-tabs").find(".nav-tab");d.eq(c).is(":visible")&&(a(this.sections[this.current_section]).hide(),this.current_section=c,a(this.sections[this.current_section]).show(),d.removeClass("nav-tab-active"),d.eq(this.current_section).addClass("nav-tab-active"))},addHandleListener:function(){var b=a("span.host"),c=a("<div><p>Shortcode:</p><code>[ca-sidebar id="+a("#current_sidebar").val()+"]</code><p>Template Tag:</p><code>ca_display_sidebar();</code></div>"),d=a("span.merge-pos");b.after(c),a("select[name='handle']").change(function(){var e=a(this);b.attr("disabled",2==e.val()),2==e.val()?(b.hide(),c.show()):(b.show(),c.hide()),3==e.val()?d.hide():d.show()}).change()},suggestVisibility:function(){var b=a(".js-cas-visibility");b.select2({theme:"wpca",placeholder:CASAdmin.allVisibility,minimumInputLength:0,closeOnSelect:!0,allowClear:!1,nextSearchTerm:function(a,b){return b},data:CASAdmin.visibility}).on("select2:selecting",function(a){b.data("forceOpen",!0)}).on("select2:close",function(a){b.data("forceOpen")&&(a.preventDefault(),b.select2("open"),b.data("forceOpen",!1))}),b.data("value")&&b.val(b.data("value").toString().split(",")).trigger("change")}};a(document).ready(function(){b.init()})}(jQuery);